{% extends 'base.html' %}

{% block head %}

    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-3.0.1.min.js"></script>
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.0.1.min.js"></script>
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.0.1.min.js"></script>
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-gl-3.0.1.min.js"></script>
    <script src="https://cdn.bokeh.org/bokeh/release/bokeh-api-3.0.1.min.js"></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='style/plot.css') }}?v=1">


{% endblock head %}
{% block title %}{{ sample }} - Segment {{ segment }}{% endblock title %}

{% block large_navigation %}
    {% if previous_sample %}
        <a class="mdl-navigation__link" href="{{ url_for('view.sample_segment_view', project_id = project_id, sample=previous_sample, segment=previous_segment) }}">Previous</a>
    {% endif %}
    {% if next_sample %}
    <a class="mdl-navigation__link" href="{{ url_for('view.sample_segment_view', project_id = project_id, sample=next_sample, segment=next_segment) }}">Next</a>
    {% endif %}
{% endblock large_navigation %}

{% block side_navigation %}
    <a class="mdl-navigation__link" href="">Link</a>
{% endblock side_navigation %}

{% block content %}
<div style="margin: 2px;">

  <div class="mdl-grid">
    <div class="mdl-cell mdl-cell--7-col" style="padding: 5px 2px; width: 760px;">
        <form id="pointForm" method="post" >
              {% for num in peakCount|loop %}
                  <p style="margin-bottom: 2px;"><b>Peak {{ num }}</b></p>
                  <div class="slider-container">
                    <label class="slider_label" for="slider_start{{ num }}">Start:</label>
                    <input class ="slider slider_start{{ num }}" type="range" id="slider_start_{{ num }}" name="sliderstart_{{ num }}" value="100" min="-50" max="300" step="0.00001" oninput="updatePoint(false, this.id)" onmouseup="updatePoint(true, this.id)">
                    <input class="slider-input" type="number" id="slider_start_{{ num }}_text" name = "start_{{ num }}" step="0.1" min="-50" max="300" onchange="updateSlider('slider_start_{{ num }}');">
                </div>
                <div class="slider-container">
                    <label class="slider_label" for="slider_end_{{ num }}">Ende:</label>
                    <input class ="slider slider_end{{ num }}" type="range" id="slider_end_{{ num }}" name="sliderend_{{ num }}" value="100" min="-50" max="300" step="0.00001" oninput="updatePoint(false, this.id)" onmouseup="updatePoint(true, this.id)">
                    <input class="slider-input" type="number" id="slider_end_{{ num }}_text" name = "end_{{ num }}" step="0.1" min="-50" max="300" onchange="updateSlider('slider_end_{{ num }}');">
                </div>
              {% endfor %}
                <input type="hidden" name="jsonPeak" id="jsonPeak"><!-- Wird im POST übergeben! -->
                <input type="hidden" name="action" value="plot_edit"><!-- zur Identifizierung des POSTs  -->
        </form>
        <div id="plot"></div>
    </div>
    <div class="mdl-cell mdl-cell--5-col" style="padding: 5px 2px; flex-grow: 1; width: auto; min-width: 420px; max-width: 760px;">
        <table class="mdl-data-table mdl-js-data-table mdl-data-table--selectable mdl-shadow--2dp" id="peakTable" style="margin-top: 25px;width: 100%;">
            <thead>
                <tr>
                    <th>Peak</th>
                    <th>Peak Temperature</th>
                    <th>Area</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
        <div class="mdl-grid">
            <div class="mdl-cell">
                <form id="tableDeleteForm" method="post">
                    <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" type="button" style="margin: 10px 0; min-width: 120px;" onclick="tableDeletePeaks()">Löschen</button>
                    <input type="hidden" id="jsonPeak_table" name="jsonPeak">
                    <input type="hidden" name="action" value="table_delete">
                </form>
            </div>
            <div class="mdl-cell" style="flex-grow: 1; width: auto;">
                <form id="tableAddForm" method="post">
                    {% if peakCount < 3 %}
                        <button class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect" style="float: right;" onclick="tableAddPeak()">
                            <i class="material-icons">add</i>
                        </button>
                    {% else %}
                        <button class="mdl-button mdl-js-button mdl-button--fab" style="float: right;" onclick="tableAddPeak()" disabled>
                            <i class="material-icons">add</i>
                        </button>
                    {% endif %}
                     <input type="hidden" id="jsonPeak_table_add" name="jsonPeak">
                    <input type="hidden" name="action" value="table_add">
                </form>
            </div>
        </div>
    </div>
  </div>
</div>


<script>
     var jsonPeak = {{ jsonPeak|safe }};
     var jsonMeasurement = {{ jsonMeasurement|safe }};

     var peakCount = {{ peakCount|safe }};

     const tableBody = document.querySelector("#peakTable tbody");

</script>
<script src="{{ url_for('static', filename='script/plot_script.js') }}?v=1.6"></script>

{% endblock content %}